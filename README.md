# HubitatZigbeeStats

Hubitat driver and python script for collecting statistics from Zigbee devices.  Helps with understanding what is happening with Zigbee network, how good/bad connectivity is.

Python script connects to [Zigbee logs on the hub](https://docs2.hubitat.com/en/user-interface/settings/zigbee-logs). It listens for events, and stores them.
Hubitat driver read statistics generated by the python script.

Initial version was implemented as Hubitat driver, however it was never release because the driver would hang the hub.  Assuming it happened because the driver was listening for websocket events generated by the same process, but this is not confirmed.


## Installation
### Python web service
Required: python 3.9+
1. Create a virtual environment, e.g. by running `python3 -m venv venv`
2. Activate the virtual environment, e.g. by running `. venv/bin/activate.sh`
3. Install the requirements, e.g. by running `python3 -m pip install -r requirements.txt`
4. Run either as a script or from `quart` application
- Run as a script with `python3 ./listener.py`.  In this case web-service is going to be running on port 8080
- Run from `quart` with `QUART_APP=listener:app quart run`.  In this case the port vbe set via TBD
5. Verify that it works by navigating to `http://<ip-address>:8080`

### Hubitat driver
1. Go to `Driver code`
2. Create `New driver`
3. Past code from `ZigbeeStats.groovy`
4. Go to `Devices`
5. Add a new virtual device with `Type` set to `User/ZigBeeStats`
6. Configure `URL of site running on listener.py` parameter. Take the value from step 5 of Python web service instuction
7. Enable the device on a dashboard
8. Add attributes `tileStats` and `tileTopN` as tiles on a dashboard


###Example how data looks on a dashboard
<img src="dashboard.png">
