# HubitatZigbeeStats

Hubitat driver and a python script for collecting statistics from Zigbee devices jointed to the hub.
Helps with understanding what is happening with Zigbee network, how good/bad connectivity is.

Python script connects to [Zigbee logs on the hub](https://docs2.hubitat.com/en/user-interface/settings/zigbee-logs). It listens for events, and stores them.
Hubitat driver read statistics generated by the python script.  Since there is a limit on attribute size in hubitat (1024 characters), `/topN` version for tile has a limit on how many devices to return. 

Initial version was implemented as Hubitat driver, however it was never released because the driver would hang the hub.
Assuming it happened because the driver was listening for websocket events generated by the same process, but this is not confirmed.


## Installation

### Python web service in a docker container
1. `docker pull nick0987/zigbee-stats:tagname`
2. Run the image with the following options  
  * Mount `config.toml` to `/app/config.toml`
  * Mount `data.json` to `/app/data.json`
  * Expose container HTTP port 8080 to a local port

### Hubitat driver
1. Go to `Drivers code`
2. Create `New driver`
3. Past the code from `ZigbeeStats.groovy`.  Press `Save`
4. Go to `Devices`
5. Add a new virtual device with `Type` set to `User/ZigbeeStats`
6. Configure `URL of site running on listener.py` parameter. Take the value from step 6 of the instruction above
7. Press `Save`
8. Enable the device on a dashboard
9. Add attributes `tileStats` and `tileTopN` as tiles on the dashboard


### Example how data looks on a dashboard
<img src="dashboard.png" alt="Dashboard sample">
